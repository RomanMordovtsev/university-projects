import os
from pathlib import Path
from typing import Dict, Literal, List

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É—Ç–µ–π
BASE_DIR = Path(__file__).parent.parent
DB_DIR = BASE_DIR / "data"
DB_DIR.mkdir(exist_ok=True)

# –ü—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º –¥–∞–Ω–Ω—ã—Ö
CHAT_HISTORY_PATH = DB_DIR / "chat_history.json"
USER_SETTINGS_PATH = DB_DIR / "user_settings.json"

# –ì–æ–ª–æ—Å–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
VOICE_CONFIG: Dict[str, Dict[str, str]] = {
    "male": {
        "en": "com",    # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π –º—É–∂—Å–∫–æ–π (–∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏–π)
        "fr": "ca",     # –§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π –º—É–∂—Å–∫–æ–π (–∫–∞–Ω–∞–¥—Å–∫–∏–π)
        "es": "com.mx", # –ò—Å–ø–∞–Ω—Å–∫–∏–π –º—É–∂—Å–∫–æ–π (–º–µ–∫—Å–∏–∫–∞–Ω—Å–∫–∏–π)
        "de": "de"      # –ù–µ–º–µ—Ü–∫–∏–π –º—É–∂—Å–∫–æ–π
    },
    "female": {
        "en": "co.uk",  # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π –∂–µ–Ω—Å–∫–∏–π (–±—Ä–∏—Ç–∞–Ω—Å–∫–∏–π)
        "fr": "fr",     # –§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π –∂–µ–Ω—Å–∫–∏–π (—Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π)
        "es": "es",     # –ò—Å–ø–∞–Ω—Å–∫–∏–π –∂–µ–Ω—Å–∫–∏–π (–∏—Å–ø–∞–Ω—Å–∫–∏–π)
        "de": "de"      # –ù–µ–º–µ—Ü–∫–∏–π –∂–µ–Ω—Å–∫–∏–π
    }
}

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–æ–ª–æ—Å–æ–≤
VOICE_SETTINGS = {
    "ru": {"gender": ["female", "male"], "accent": "russia"},
    "en": {"gender": ["female", "male"], "accent": ["us", "uk"]},
    "es": {"gender": ["female", "male"], "accent": ["spain", "mexico"]},
    "it": {"gender": ["female", "male"], "accent": "italia"},
    "ja": {"gender": ["female", "male"], "accent": "japan"},
    # ... –¥—Ä—É–≥–∏–µ —è–∑—ã–∫–∏
}

VOICE_REFERENCES = {
    "es": {"region": "eu"},  # –ò—Å–ø–∞–Ω—Å–∫–∏–π (–µ–≤—Ä–æ–ø–µ–π—Å–∫–∏–π)
    "ru": {"region": None}   # –†—É—Å—Å–∫–∏–π –±–µ–∑ —Ä–µ–≥–∏–æ–Ω–∞
}

VOICE_SETTINGS.update({
    "it": {"tld": "it", "speed": 1.05, "lang": "it"},
    "ja": {"tld": "co.jp", "speed": 0.95, "lang": "ja"},
    "zh": {"tld": "com", "speed": 0.9, "lang": "zh-CN"}
})

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤
RESPONSE_FORMAT = {
    "section_headers": {
        "target": "### 1. –û—Å–Ω–æ–≤–Ω–æ–π –æ—Ç–≤–µ—Ç ({language})",
        "translation": "### 2. –î–æ—Å–ª–æ–≤–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ ({native_lang})",
        "analysis": "### 3. –†–∞–∑–±–æ—Ä —Ñ—Ä–∞–∑",
        "advanced": "### 4. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ"
    },
    "markers": {
        "keywords": "‚û§",
        "mistakes": "‚ö†Ô∏è",
        "culture": "üåç",
        "nuances": "üí°",
        "alternatives": "üîç"
    }
}

# –ü–æ–ª–Ω—ã–π —à–∞–±–ª–æ–Ω –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è —è–∑—ã–∫–æ–≤–æ–≥–æ –º–µ–Ω—Ç–æ—Ä–∞
MENTOR_PROMPT_TEMPLATE = """
–¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π AI-–ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å —è–∑—ã–∫–æ–≤. –í—Å–µ–≥–¥–∞ —Å—Ç—Ä–æ–≥–æ —Å–ª–µ–¥—É–π —ç—Ç–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É:

### 1. –û—Å–Ω–æ–≤–Ω–æ–π –æ—Ç–≤–µ—Ç (–∏–∑—É—á–∞–µ–º—ã–π —è–∑—ã–∫: {target_language})
[–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ —Ü–µ–ª–µ–≤–æ–º —è–∑—ã–∫–µ. –ë–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π!]

### 2. –î–æ—Å–ª–æ–≤–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ (—Ä–æ–¥–Ω–æ–π —è–∑—ã–∫: {native_language})
[–¢–æ—á–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π. –ë–µ–∑ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–π!]

### 3. –†–∞–∑–±–æ—Ä —Ñ—Ä–∞–∑ (–¥–ª—è —É—Ä–æ–≤–Ω–µ–π A1-B2)
- ‚û§ **–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞**:
  [–°–ª–æ–≤–æ/—Ñ—Ä–∞–∑–∞ 1] - [–ø–µ—Ä–µ–≤–æ–¥] (–ø—Ä–∏–º–µ—Ä: "[–ø—Ä–∏–º–µ—Ä –Ω–∞ —Ü–µ–ª–µ–≤–æ–º —è–∑—ã–∫–µ] ‚Üí [–ø–µ—Ä–µ–≤–æ–¥]")
  [–°–ª–æ–≤–æ/—Ñ—Ä–∞–∑–∞ 2] - [–ø–µ—Ä–µ–≤–æ–¥] (–∫–æ–Ω—Ç–µ–∫—Å—Ç: "[—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –≤ —Ä–µ—á–∏]")
- ‚ö†Ô∏è **–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏**:
  [–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ] ‚Üí [–ü—Ä–∞–≤–∏–ª—å–Ω–æ] (–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ: "–ü–æ—á–µ–º—É?")
- üåç **–ö—É–ª—å—Ç—É—Ä–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç**:
  [–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç –∏–ª–∏ –Ω–æ—Ä–º–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è]

### 4. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (–¥–ª—è —É—Ä–æ–≤–Ω–µ–π C1-C2)
- üí° **–ù—é–∞–Ω—Å—ã —è–∑—ã–∫–∞**:
  [–°—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ/–¥–∏–∞–ª–µ–∫—Ç–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏]
- üîç **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã**:
  [–°–∏–Ω–æ–Ω–∏–º–∏—á–Ω—ã–µ —Ñ—Ä–∞–∑—ã —Å —Ä–∞–∑–Ω–æ–π —Å—Ç–∏–ª–∏—Å—Ç–∏–∫–æ–π]

---

### –ñ–µ—Å—Ç–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞:
1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–æ–≤**:
   - –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–º–µ—à–∏–≤–∞–π —è–∑—ã–∫–∏ –≤ –æ–¥–Ω–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏
   - –°–∫–æ–±–∫–∏ () –∏—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –¥–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤/–ø–æ—è—Å–Ω–µ–Ω–∏–π –≤ —Ä–∞–∑–¥–µ–ª–µ 3

2. **–ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —É—Ä–æ–≤–µ–Ω—å**:
   - A1-A2: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç—ã–µ —Ñ—Ä–∞–∑—ã + 2-3 —Ä–∞–∑–±–æ—Ä–∞
   - B1-B2: –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ + 1-2 –Ω—é–∞–Ω—Å–∞
   - C1-C2: –ê–∫—Ü–µ–Ω—Ç –Ω–∞ –∏–¥–∏–æ–º–∞—Ö –∏ —Å—Ç–∏–ª–∏—Å—Ç–∏–∫–µ

3. **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã (###, ‚û§, ‚ö†Ô∏è, üåç)
   - –ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏
   - –ö–∞–≤—ã—á–∫–∏ ¬´¬ª –¥–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤

---

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ (—Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π, —É—Ä–æ–≤–µ–Ω—å A2):
### 1. –û—Å–Ω–æ–≤–Ω–æ–π –æ—Ç–≤–µ—Ç (—Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π)
Bonjour, je voudrais r√©server une table pour deux personnes, s'il vous pla√Æt.

### 2. –î–æ—Å–ª–æ–≤–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ (—Ä—É—Å—Å–∫–∏–π)
–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —è —Ö–æ—Ç–µ–ª –±—ã –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–æ–ª–∏–∫ –Ω–∞ –¥–≤–æ–∏—Ö, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞.

### 3. –†–∞–∑–±–æ—Ä —Ñ—Ä–∞–∑
- ‚û§ **–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞**:
  ¬´je voudrais¬ª - ¬´—è —Ö–æ—Ç–µ–ª –±—ã¬ª (–ø—Ä–∏–º–µ—Ä: ¬´Je voudrais un caf√©¬ª ‚Üí ¬´–Ø —Ö–æ—Ç–µ–ª –±—ã –∫–æ—Ñ–µ¬ª)
  ¬´une table¬ª - ¬´—Å—Ç–æ–ª–∏–∫¬ª (–∫–æ–Ω—Ç–µ–∫—Å—Ç: ¬´—Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—è –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ¬ª)
- ‚ö†Ô∏è **–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏**:
  ¬´Je veux¬ª ‚Üí ¬´Je voudrais¬ª (–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ: "Je veux –∑–≤—É—á–∏—Ç –≥—Ä—É–±–æ –≤ —ç—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ")
- üåç **–ö—É–ª—å—Ç—É—Ä–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç**:
  –í–æ –§—Ä–∞–Ω—Ü–∏–∏ –ø—Ä–∏–Ω—è—Ç–æ –Ω–∞–∑—ã–≤–∞—Ç—å —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –±—Ä–æ–Ω–∏ (¬´pour 19h¬ª)

### 4. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (–¥–ª—è B2+)
- üí° **–ù—é–∞–Ω—Å—ã —è–∑—ã–∫–∞**:
  –í –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω–æ–π –æ–±—Å—Ç–∞–Ω–æ–≤–∫–µ –º–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å ¬´Je vais prendre...¬ª (–¥–æ—Å–ª. ¬´–Ø –≤–æ–∑—å–º—É...¬ª)
- üîç **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã**:
  –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ: ¬´Je souhaiterais...¬ª (–±–æ–ª–µ–µ –≤–µ–∂–ª–∏–≤–æ)
  –î—Ä—É–∑—å—è–º: ¬´On peut avoir...?¬ª (¬´–ú–æ–∂–Ω–æ –Ω–∞–º...?¬ª)
"""

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ AI
GEMINI_CONFIG = {
    "model_name": "gemini-1.5-pro-latest",
    "safety_settings": [
        {
            "category": "HARM_CATEGORY_HARASSMENT",
            "threshold": "BLOCK_ONLY_HIGH"
        },
        {
            "category": "HARM_CATEGORY_HATE_SPEECH",
            "threshold": "BLOCK_ONLY_HIGH"
        },
        {
            "category": "HARM_CATEGORY_SEXUALLY_EXPLICIT",
            "threshold": "BLOCK_ONLY_HIGH"
        },
        {
            "category": "HARM_CATEGORY_DANGEROUS_CONTENT",
            "threshold": "BLOCK_ONLY_HIGH"
        }
    ],
    "generation_config": {
        "temperature": 0.7,
        "top_p": 0.9,
        "max_output_tokens": 2000,
        "stop_sequences": ["###"]  # –ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
    }
}

# –£—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
LEVEL_DESCRIPTIONS = {
    "A1": "–ù–∞—á–∏–Ω–∞—é—â–∏–π (–ø–æ–Ω–∏–º–∞–µ—Ç –ø—Ä–æ—Å—Ç—ã–µ —Ñ—Ä–∞–∑—ã)",
    "A2": "–≠–ª–µ–º–µ–Ω—Ç–∞—Ä–Ω—ã–π (–º–æ–∂–µ—Ç –æ–±—â–∞—Ç—å—Å—è –Ω–∞ –±—ã—Ç–æ–≤—ã–µ —Ç–µ–º—ã)",
    "B1": "–°—Ä–µ–¥–Ω–∏–π (–º–æ–∂–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –±–µ—Å–µ–¥—É)",
    "B2": "–í—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ (—Å–≤–æ–±–æ–¥–Ω–æ –≥–æ–≤–æ—Ä–∏—Ç –Ω–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ç–µ–º)",
    "C1": "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π (–ø–æ–Ω–∏–º–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã)",
    "C2": "–í–ª–∞–¥–µ–Ω–∏–µ –≤ —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–µ"
}

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∞–≤—Ç–æ–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
REMINDER_SETTINGS = {
    "min_interval_hours": 24,
    "max_interval_hours": 48,
    "reminder_messages": {
        "en": [
            "Hey! Let's practice some {language} today!",
            "Ready for our daily {language} chat?"
        ],
        "ru": [
            "–ü—Ä–∏–≤–µ—Ç! –î–∞–≤–∞–π —Å–µ–≥–æ–¥–Ω—è –ø–æ–ø—Ä–∞–∫—Ç–∏–∫—É–µ–º {language}!",
            "–ì–æ—Ç–æ–≤ –∫ –Ω–∞—à–µ–π –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–µ {language}?"
        ]
    }
}

# –î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞:

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ TTS
TTS_CONFIG = {
    "model": "xtts_v2",
    "languages": {
        "en": {"speakers": ["male", "female"], "accents": ["us", "uk"]},
        "ru": {"speakers": ["male", "female"], "accents": ["russia"]},
        # ... –¥—Ä—É–≥–∏–µ —è–∑—ã–∫–∏
    },
    "default_speaker": "female",
    "silence_duration_ms": 800
}

# –õ–∏–º–∏—Ç—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
SAFETY_LIMITS = {
    "max_text_length": 1000,
    "min_interval_seconds": 5
}

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
CACHE_SETTINGS = {
    "voice_cache_ttl": 3600,  # 1 —á–∞—Å
    "max_cache_size": 100  # –ú–∞–∫—Å. –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤
}

# –í –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ:
DEFAULT_SETTINGS = {
    "max_response_length": 500,
    "auto_reminders": True,
    "speech_speed": 1.0,
    "feedback_level": "detailed"  # basic/normal/detailed
}

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤
VOICE_REFERENCE_FORMATS = {
    # –Ø–∑—ã–∫–∏ —Å –∞–∫—Ü–µ–Ω—Ç–∞–º–∏
    "es": "{lang}_{region}_{gender}.wav",  # es_eu_female.wav, es_la_male.wav
    "en": "{lang}_{region}_{gender}.wav",  # en_uk_female.wav, en_us_male.wav

    # –Ø–∑—ã–∫–∏ –±–µ–∑ –∞–∫—Ü–µ–Ω—Ç–æ–≤
    "ru": "{lang}_{gender}.wav",  # ru_female.wav
    "ja": "{lang}_{gender}.wav",
    "zh": "{lang}_{gender}.wav"
}

# –†–µ–≥–∏–æ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —è–∑—ã–∫–æ–≤ —Å –∞–∫—Ü–µ–Ω—Ç–∞–º–∏
DEFAULT_REGIONS = {
    "es": "eu",  # –ò—Å–ø–∞–Ω—Å–∫–∏–π (–µ–≤—Ä–æ–ø–µ–π—Å–∫–∏–π)
    "en": "us"  # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π (–∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏–π)
}
